{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 72, "column": 0}, "map": {"version":3,"sources":["file:///C:/tubes/Inventory%20Management%20System/app/api/auth/login/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\nimport { createClient } from '@libsql/client';\r\nimport jwt from 'jsonwebtoken';\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const { username, password } = await request.json();\r\n\r\n    if (!username || !password) {\r\n      return NextResponse.json(\r\n        { success: false, message: 'Username dan password harus diisi' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Create direct client connection\r\n    const client = createClient({\r\n      url: process.env.TURSO_DATABASE_URL || '',\r\n      authToken: process.env.TURSO_AUTH_TOKEN || '',\r\n    });\r\n\r\n    // Query user from database\r\n    const userResult = await client.execute('SELECT * FROM users WHERE username = ? AND isActive = 1', [username]);\r\n    const user = userResult.rows[0];\r\n\r\n    if (!user) {\r\n      return NextResponse.json(\r\n        { success: false, message: 'Username tidak ditemukan atau akun tidak aktif', error: 'USER_NOT_FOUND' },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    // Simple password check (in production, use bcrypt)\r\n    if (user.password !== password) {\r\n      return NextResponse.json(\r\n        { success: false, message: 'Password salah. Silakan coba lagi.', error: 'INVALID_PASSWORD' },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    // Create JWT token\r\n    const token = jwt.sign(\r\n      { \r\n        id: user.id,\r\n        username: user.username,\r\n        role: user.role\r\n      },\r\n      process.env.JWT_SECRET || 'fallback-secret-change-in-production',\r\n      { expiresIn: '7d' }\r\n    );\r\n    \r\n    const response = NextResponse.json({\r\n      success: true,\r\n      token,\r\n      user: {\r\n        id: user.id,\r\n        username: user.username,\r\n        email: user.email,\r\n        name: user.name,\r\n        role: user.role,\r\n        isActive: user.isActive\r\n      },\r\n      message: 'Login berhasil'\r\n    });\r\n\r\n    // Set JWT token in httpOnly cookie (more secure)\r\n    response.cookies.set('token', token, {\r\n      httpOnly: true,\r\n      secure: process.env.NODE_ENV === 'production',\r\n      sameSite: 'lax',\r\n      maxAge: 60 * 60 * 24 * 7, // 7 days\r\n      path: '/'\r\n    });\r\n\r\n    return response;\r\n\r\n  } catch (error) {\r\n    console.error('Login API error:', error);\r\n    return NextResponse.json(\r\n      { success: false, message: 'Terjadi kesalahan server' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;;;;;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,EAAE,QAAQ,EAAE,QAAQ,EAAE,GAAG,MAAM,QAAQ,IAAI;QAEjD,IAAI,CAAC,YAAY,CAAC,UAAU;YAC1B,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,SAAS;YAAoC,GAC/D;gBAAE,QAAQ;YAAI;QAElB;QAEA,kCAAkC;QAClC,MAAM,SAAS,IAAA,6MAAY,EAAC;YAC1B,KAAK,QAAQ,GAAG,CAAC,kBAAkB,IAAI;YACvC,WAAW,QAAQ,GAAG,CAAC,gBAAgB,IAAI;QAC7C;QAEA,2BAA2B;QAC3B,MAAM,aAAa,MAAM,OAAO,OAAO,CAAC,2DAA2D;YAAC;SAAS;QAC7G,MAAM,OAAO,WAAW,IAAI,CAAC,EAAE;QAE/B,IAAI,CAAC,MAAM;YACT,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,SAAS;gBAAkD,OAAO;YAAiB,GACrG;gBAAE,QAAQ;YAAI;QAElB;QAEA,oDAAoD;QACpD,IAAI,KAAK,QAAQ,KAAK,UAAU;YAC9B,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,SAAS;gBAAsC,OAAO;YAAmB,GAC3F;gBAAE,QAAQ;YAAI;QAElB;QAEA,mBAAmB;QACnB,MAAM,QAAQ,kJAAG,CAAC,IAAI,CACpB;YACE,IAAI,KAAK,EAAE;YACX,UAAU,KAAK,QAAQ;YACvB,MAAM,KAAK,IAAI;QACjB,GACA,QAAQ,GAAG,CAAC,UAAU,IAAI,wCAC1B;YAAE,WAAW;QAAK;QAGpB,MAAM,WAAW,gJAAY,CAAC,IAAI,CAAC;YACjC,SAAS;YACT;YACA,MAAM;gBACJ,IAAI,KAAK,EAAE;gBACX,UAAU,KAAK,QAAQ;gBACvB,OAAO,KAAK,KAAK;gBACjB,MAAM,KAAK,IAAI;gBACf,MAAM,KAAK,IAAI;gBACf,UAAU,KAAK,QAAQ;YACzB;YACA,SAAS;QACX;QAEA,iDAAiD;QACjD,SAAS,OAAO,CAAC,GAAG,CAAC,SAAS,OAAO;YACnC,UAAU;YACV,QAAQ,oDAAyB;YACjC,UAAU;YACV,QAAQ,KAAK,KAAK,KAAK;YACvB,MAAM;QACR;QAEA,OAAO;IAET,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,oBAAoB;QAClC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAO,SAAS;QAA2B,GACtD;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}